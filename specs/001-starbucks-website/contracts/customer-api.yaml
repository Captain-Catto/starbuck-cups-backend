openapi: 3.0.3
info:
  title: Starbucks Cup E-commerce API
  description: API for customer product browsing and admin management
  version: 1.0.0
  contact:
    name: Development Team
    email: dev@starbucks-cups.com

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.starbucks-cups.com/v1
    description: Production server

paths:
  # Customer-facing endpoints
  /products:
    get:
      summary: Get products with filtering
      tags: [Customer API]
      parameters:
        - name: category
          in: query
          schema:
            type: string
          description: Filter by product category
        - name: color
          in: query
          schema:
            type: array
            items:
              type: string
          description: Filter by display colors (supports multiple)
        - name: capacity
          in: query
          schema:
            type: array
            items:
              type: string
              format: uuid
          description: Filter by capacity IDs (supports multiple)
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
          description: Items per page
      responses:
        "200":
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ProductPublic"
                  meta:
                    type: object
                    properties:
                      pagination:
                        $ref: "#/components/schemas/PaginationInfo"
                      filters:
                        $ref: "#/components/schemas/ProductFilters"
                      timestamp:
                        type: string
                        format: date-time
                      total_records:
                        type: integer
                  error:
                    type: null
                required: [success, data, meta, error]
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /products/{id}:
    get:
      summary: Get single product details
      tags: [Customer API]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Product ID (UUID) or slug
          example: "123e4567-e89b-12d3-a456-426614174000 hoặc ly-starbucks-classic-trang-450ml"
      responses:
        "200":
          description: Product details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/ProductPublic"
                  meta:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                  error:
                    type: null
                required: [success, data, meta, error]
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /products/{id}/color-consultation:
    post:
      summary: Request color consultation for a specific product
      tags: [Customer API]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Product ID (UUID) or slug
          example: "ly-starbucks-classic-trang-450ml"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                customer_message:
                  type: string
                  description: Customer's question about colors or preferences
                  example: "Tôi muốn xem màu khác của sản phẩm này"
                preferred_colors:
                  type: array
                  items:
                    type: string
                  description: Colors customer is interested in (optional)
                  example: ["đen", "hồng", "xanh"]
              required: [customer_message]
      responses:
        "200":
          description: Color consultation request created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      messenger_url:
                        type: string
                        format: uri
                        description: URL to start Messenger conversation
                      consultation_id:
                        type: string
                        format: uuid
                        description: Reference ID for this consultation
                      message_preview:
                        type: string
                        description: Preview of the message that will be sent
                        example: "Xin chào! Tôi muốn tư vấn về màu sắc cho sản phẩm Tumbler Classic 450ml"
                  meta:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                      product_name:
                        type: string
                  error:
                    type: null
                required: [success, data, meta, error]
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /categories:
    get:
      summary: Get available product categories
      tags: [Customer API]
      responses:
        "200":
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        count:
                          type: integer
                          description: Number of products in category
                  meta:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                      total_categories:
                        type: integer
                  error:
                    type: null
                required: [success, data, meta, error]

  /cart/messenger-redirect:
    post:
      summary: Generate Messenger redirect for consultation
      tags: [Customer API]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                products:
                  type: array
                  items:
                    type: object
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      requested_color:
                        type: string
                        nullable: true
                        description: Customer's preferred color if different from product's display color
                      quantity:
                        type: integer
                        minimum: 1
                message_type:
                  type: string
                  enum: [cart_consultation, product_consultation]
              required: [products, message_type]
      responses:
        "200":
          description: Messenger redirect URL generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      messenger_url:
                        type: string
                        format: uri
                      message_template:
                        type: string
                  meta:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                      product_count:
                        type: integer
                  error:
                    type: null
                required: [success, data, meta, error]
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

components:
  schemas:
    ProductPublic:
      type: object
      properties:
        id:
          type: string
          format: uuid
        slug:
          type: string
          description: SEO-friendly URL identifier
          example: "ly-starbucks-classic-trang-450ml"
        name:
          type: string
        description:
          type: string
        capacity:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            value_ml:
              type: integer
          description: Capacity information for the product
          example:
            id: "123e4567-e89b-12d3-a456-426614174000"
            name: "450ml"
            value_ml: 450
        display_color:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            hex_code:
              type: string
          description: Color information for the product
          example:
            id: "123e4567-e89b-12d3-a456-426614174000"
            name: "Trắng"
            hex_code: "#FFFFFF"
        category:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            slug:
              type: string
          description: Category information for the product
          example:
            id: "123e4567-e89b-12d3-a456-426614174000"
            name: "Ly giai - Cold Cup"
            slug: "ly-giai-cold-cup"
        images:
          type: array
          items:
            type: string
            format: uri
          description: Array of image URLs for the display color
          example:
            [
              "https://example.com/tumbler-white-1.jpg",
              "https://example.com/tumbler-white-2.jpg",
            ]
        product_url:
          type: string
          format: uri
        in_stock:
          type: boolean
          description: Whether product is available
        consultation_note:
          type: string
          description: Note encouraging customers to consult for other colors
          example: "Có màu khác? Tư vấn qua Messenger để xem thêm lựa chọn!"
      required:
        [id, slug, name, capacity, display_color, category, images, in_stock]

    ProductFilters:
      type: object
      properties:
        categories:
          type: array
          items:
            type: string
        colors:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              count:
                type: integer
                description: Number of products with this display color
        capacity_ranges:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              name:
                type: string
              value_ml:
                type: integer
              count:
                type: integer
                description: Number of products with this capacity

    PaginationInfo:
      type: object
      properties:
        current_page:
          type: integer
        per_page:
          type: integer
        total_pages:
          type: integer
        total_items:
          type: integer
        has_next:
          type: boolean
        has_prev:
          type: boolean
      required:
        [current_page, per_page, total_pages, total_items, has_next, has_prev]

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: null
              meta:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
              error:
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  details:
                    type: array
                    items:
                      type: string
            required: [success, data, meta, error]

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: null
              meta:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
              error:
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
            required: [success, data, meta, error]

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              data:
                type: null
              meta:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
              error:
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
            required: [success, data, meta, error]
